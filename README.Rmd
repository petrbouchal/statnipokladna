---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# statnipokladna <img src='man/figures/logo.png' align="right" height="138" />

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/statnipokladna)](https://CRAN.R-project.org/package=statnipokladna)
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![Travis build status](https://travis-ci.org/petrbouchal/statnipokladna.svg?branch=master)](https://travis-ci.org/petrbouchal/statnipokladna)
<!-- badges: end -->

The goal of statnipokladna is to provide programmatic access to open data from the Státní pokladna system. Státní pokladna is a comprehensive budgeting, reporting and accounting system for Czech public organisations. This package provides user-friendly ways to access the open data from that system available at <https://monitor.statnipokladna.cz>.

## Installation

The package is not on CRAN.

You can install the current released version of statnipokladna from [GitHub](https://github.com/petrbouchal/statnipokladna) with:

``` r
remotes::install_github("petrbouchal/statnipokladna",
                        build_vignettes = T,
                        ref = github_release())
```

or the latest development version with

``` r
remotes::install_github("petrbouchal/statnipokladna",
                         build_vignettes = T)
```

## What this package enables you to do:

- get cleaned-up, ready to analyse data frames based on open data dumps from the public finance database 
  - the package draws on the online data and returns a clean data frame
  - the resulting data is ready to merge into time series
  - time series is built based on user input
- do this through a consistent API which supplements some of the documentation that is missing from the official endpoints (*still subject to some chainge*)
- access registers published alongside the data (e.g. lists of public organisations with their identifiers and metadata), some of which can be useful in other contexts
- augment the core data with the desired type of register

## How does this compare to the [official analytical interface](http://monitor.statnipokladna.cz/)?

- no limit on the number of data points
- no limits on the number of organisations, unlike the official interface which forces you to use a filter on some tables
- different reports (local gov, central gov...) in one place in consistent form
- much faster for analysis (the current version of the online interface takes long to render)
- reproducible!!! While the online interface provides a permanent link to your analysis, this must be copied manually and does not necessarily provide an easily legible overview of how the analysis was produced (filters, columns etc.)
- no need for the web => excel => R dance
- drawback: for some reports, the data is published in different forms for different time periods (pre- and post-2015)
- drawback: consolidation must be done manually

Note the official analysis GUI is due to be [overhauled in November 2018](https://twitter.com/otevrenadatamf/status/1190329092916289536).

## Getting started

```{r message=FALSE, warning=F}
library(statnipokladna)
```

Get data from a particular part (file) of a dataset ("výkaz"):

```{r}
local_budgets <- get_table(table_id = "budget-local", # table ID, see `sp_tables`
                           year = 2019,
                           month = 9)
```

The data is automatically downloaded to a cache directory, so it will be reused by future calls to `get_table()` made in the same session, unless you set `force_redownload = T`. 

It is a rather raw-looking data frame...

```{r}
head(local_budgets)
```

...but it has been cleaned up, and can be enriched with any of the metadata codelists:

```{r}
functional_categories <- get_codelist("paragraf")
```

```{r}
functional_categories
```

This contains all codes for this codelist, some of which are not valid for the time period of our core data. The function `add_codelist()` resolves this automatically.

As you can see below, you can 

- add multiple codelists in one pipe
- add a codelist without downloading it first - just pass its ID to the function instead of an object.

```{r}
local_budgets %>% 
  add_codelist(functional_categories) %>% 
  add_codelist("polozka")
```

Download a whole "výkaz" (dataset):

```{r}
get_dataset("finm") # dataset ID, see `sp_datasets`
```

and look at its documentation:

```{r}
statnipokladna::get_dataset_doc("finm")
```

## Background information

Note that while the package provides a bridge from complicated data dumps to a clean data structure, you still need quite a bit of domain knowledge to be able analyse the data safely.

See the ["How the data works"](https://petrbouchal.github.io/statnipokladna/articles/how-the-data-works.html) vignette (in Czech only, the terminology is impossible to translate) for an overview of the structure of the data on which this package draws. This also contains some notes useful for interpreting the data.

A basic glossary of some of the terms used in the data sets is at <http://monitor.statnipokladna.cz/2019/metodika/>.

### Note

Not created or endorsed by the Czech Ministry of Finance, who produce the data - but they definitely deserve credit for releasing the data and maintaining the application.

## Contributing

See CONTRIBUTING.md for a guide on how to contribute to the project.

Please note that the 'statnipokladna' project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
